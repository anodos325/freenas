#!/sbin/openrc-run
#
# $FreeBSD$
#

. /etc/rc.freenas

name="ix-system"

depend()
{
	provide ix-system
	before samba_server ix-syslogd ix-collectd
}

notifier()
{
	/usr/local/bin/midclt call notifier.$1
}

start()
{
	#FIXME: do it within middleware once pools are imported there
	/usr/local/bin/midclt call systemdataset.setup > /dev/null
	if [ "$(notifier pwenc_check)" = "False" ]; then
		notifier pwenc_generate_secret
	fi
}

